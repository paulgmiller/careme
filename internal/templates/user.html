<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Careme · User Profile</title>

  {{template "tailwind_head" .Style}}

  {{.ClarityScript}}
</head>
<body class="min-h-screen bg-gradient-to-b from-brand-50 to-white antialiased">
  <main class="px-4 py-10">
    <section class="mx-auto w-full max-w-4xl">
      <div class="rounded-2xl border border-brand-100 bg-white/90 shadow-xl">
        <div class="border-b border-brand-100 px-8 pb-6 pt-8">
          <a href="/" class="inline-flex items-center text-sm font-medium text-brand-600 underline-offset-4 hover:underline focus:outline-none focus:ring-2 focus:ring-brand-400 focus:ring-offset-2">
            ← Back to Home
          </a>
          <h1 class="mt-4 text-4xl font-extrabold tracking-tight text-brand-700">User Profile</h1>
          <p class="mt-2 text-sm text-gray-600">Manage your account details, grocery preferences, email preferences, and saved recipes.</p>
          {{if .Success}}
          <div class="mt-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
            Settings saved successfully!
          </div>
          {{end}}
        </div>

        <div class="space-y-8 px-8 py-8">
          <nav aria-label="User profile tabs" class="flex w-full gap-2 rounded-xl bg-brand-50 p-1">
            <a href="/user?tab=past"
               class="inline-flex flex-1 items-center justify-center rounded-lg px-4 py-2 text-sm font-semibold transition {{if eq .ActiveTab "past"}}bg-white text-brand-700 shadow-sm{{else}}text-brand-600 hover:bg-white/70{{end}}">
              Past recipes
            </a>
            <a href="/user?tab=customize"
               class="inline-flex flex-1 items-center justify-center rounded-lg px-4 py-2 text-sm font-semibold transition {{if ne .ActiveTab "past"}}bg-white text-brand-700 shadow-sm{{else}}text-brand-600 hover:bg-white/70{{end}}">
              Customize
            </a>
          </nav>

          {{if ne .ActiveTab "past"}}
          <section class="space-y-4">
            <h2 class="text-lg font-semibold text-brand-700">Account Information</h2>
            <div class="grid gap-3 sm:grid-cols-2">
              <div>
                <h3 class="text-sm font-medium text-gray-600">Email Addresses</h3>
                <ul class="mt-2 space-y-1 text-sm text-gray-700">
                  {{range .User.Email}}
                  <li class="rounded-lg bg-brand-50 px-3 py-2 text-brand-700">{{.}}</li>
                  {{end}}
                </ul>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-600">Member Since</h3>
                <p class="mt-2 text-sm text-gray-700">{{.User.CreatedAt.Format "January 2, 2006"}}</p>
              </div>
            </div>
          </section>

          <section class="space-y-4">
            <h2 class="text-lg font-semibold text-brand-700">Preferences</h2>
            <form method="POST" action="/user" class="space-y-6">
              <div class="space-y-2">
                <label for="favorite_store" class="text-sm font-medium text-gray-700">Favorite Store</label>
                {{if .FavoriteStoreName}}
                <div class="w-full max-w-md rounded-lg border border-gray-300 bg-gray-50 px-3 py-2 text-gray-900">
                  {{.FavoriteStoreName}}
                </div>
                <input type="hidden" name="favorite_store" value="{{.User.FavoriteStore}}" />
                <p class="text-xs text-gray-500">To change your favorite store, visit the <a href="/" class="text-brand-600 hover:underline">home page</a> and search for locations.</p>
                {{else}}
                <input id="favorite_store"
                       name="favorite_store"
                       type="text"
                       value="{{.User.FavoriteStore}}"
                       placeholder="Store ID"
                       class="w-full max-w-md rounded-lg border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-400" />
                <p class="text-xs text-gray-500">Set your favorite store from the <a href="/" class="text-brand-600 hover:underline">home page</a> by searching for locations.</p>
                {{end}}
              </div>

              <div class="space-y-2">
                <label for="shopping_day" class="text-sm font-medium text-gray-700">Shopping day of week</label>
                <select id="shopping_day"
                        name="shopping_day"
                        class="w-full max-w-xs rounded-lg border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-400">
                  <option value="">Select a day...</option>
                  <option value="Sunday" {{if eq .User.ShoppingDay "Sunday" }}selected{{end}}>Sunday</option>
                  <option value="Monday" {{if eq .User.ShoppingDay "Monday" }}selected{{end}}>Monday</option>
                  <option value="Tuesday" {{if eq .User.ShoppingDay "Tuesday" }}selected{{end}}>Tuesday</option>
                  <option value="Wednesday" {{if eq .User.ShoppingDay "Wednesday" }}selected{{end}}>Wednesday</option>
                  <option value="Thursday" {{if eq .User.ShoppingDay "Thursday" }}selected{{end}}>Thursday</option>
                  <option value="Friday" {{if eq .User.ShoppingDay "Friday" }}selected{{end}}>Friday</option>
                  <option value="Saturday" {{if eq .User.ShoppingDay "Saturday" }}selected{{end}}>Saturday</option>
                </select>
              </div>

              <div class="space-y-2">
                <label for="mail_opt_in" class="text-sm font-medium text-gray-700">Recipe emails</label>
                <label class="inline-flex items-center gap-2 text-sm text-gray-700">
                  <input id="mail_opt_in"
                         name="mail_opt_in"
                         type="checkbox"
                         value="1"
                         {{if .User.MailOptIn}}checked{{end}}
                         class="h-4 w-4 rounded border-gray-300 text-brand-600 focus:ring-brand-400" />
                  Send me recipe emails
                </label>
                <p class="text-xs text-gray-500">Turn this on to receive recipe emails from your saved store preferences.</p>
              </div>

              <button type="submit"
                      class="inline-flex items-center justify-center rounded-lg bg-brand-600 px-4 py-2.5 text-sm font-semibold text-white shadow-md transition hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-400 focus:ring-offset-2">
                Save Preferences
              </button>
            </form>
          </section>
          {{end}}

          {{if eq .ActiveTab "past"}}
          <section class="space-y-4">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <h2 class="text-lg font-semibold text-brand-700">Past Recipes</h2>
              {{if .User.LastRecipes}}
              <span class="text-xs uppercase tracking-wide text-gray-400">Recent history</span>
              {{end}}
            </div>

            <form method="POST" action="/user/recipes" class="space-y-4 rounded-xl border border-brand-100 bg-brand-50/60 p-5">
              <div class="space-y-2">
                <label for="previous_recipe" class="text-sm font-medium text-gray-700">Add a previous recipe</label>
                <input id="previous_recipe"
                       name="recipe"
                       type="text"
                       placeholder="Enter recipe name"
                       class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-400" />
                <p class="text-xs text-gray-500">Add recipes you love to personalize future recommendations.</p>
              </div>
              <button type="submit"
                      class="inline-flex items-center justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-semibold text-white shadow-md transition hover:bg-brand-600 focus:outline-none focus:ring-2 focus:ring-brand-400 focus:ring-offset-2">
                Add Recipe
              </button>
            </form>

            {{if .User.LastRecipes}}
            <ul class="divide-y divide-brand-100 rounded-xl border border-brand-100 bg-white/60">
              {{range .User.LastRecipes}}
              <li class="px-5 py-4 text-sm text-gray-700">
                <div class="font-semibold text-brand-700">
                  {{if .Hash}}
                  <a href="/recipe/{{.Hash}}" class="hover:text-brand-600 focus:outline-none focus:ring-2 focus:ring-brand-400 focus:ring-offset-2">{{.Title}}</a>
                  {{else}}
                  {{.Title}}
                  {{end}}
                </div>
                <p class="mt-1 text-xs text-gray-500">Added: {{.CreatedAt.Format "January 2, 2006"}}</p>
              </li>
              {{end}}
            </ul>
            {{else}}
            <p class="text-sm text-gray-500">No recipes yet—start by saving one from your recommendations.</p>
            {{end}}
          </section>
          {{end}}
        </div>
      </div>

      <p class="mt-6 text-center text-sm text-gray-500">Need help? Reach out from the home page.</p>
    </section>
  </main>
  {{template "clerk_refresh.html" .}}
</body>
</html>
