<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Careme Chat Result</title>
  <style>
    body{font-family:system-ui,-apple-system,sans-serif;margin:2rem;background:#f5f7fa;color:#222}
    pre{background:#111;color:#eee;padding:1rem;border-radius:8px;overflow-x:auto;white-space:pre-wrap;word-break:break-word;font-size:.9rem;line-height:1.3}
    form{margin-bottom:1.5rem;display:flex;gap:.5rem}
    input[type=text]{flex:1;padding:.6rem .8rem;border:1px solid #bbb;border-radius:4px;font-size:1rem}
    button{background:#2563eb;color:#fff;border:0;padding:.6rem 1rem;border-radius:4px;cursor:pointer;font-size:1rem}
    button:hover{background:#1d4ed8}
    .share-btn{background:#10b981;margin-top:2rem}
    .share-btn:hover{background:#059669}
    .save-form{margin-top:1rem}
    .save-btn{background:#f59e0b}
    .save-btn:hover{background:#d97706}
    .share-feedback{display:none;color:#10b981;font-size:.9rem;margin-left:.5rem}
    h1{margin-top:0}
    footer{margin-top:2rem;font-size:.75rem;color:#666}
  </style>
  {{.ClarityScript}}
</head>
<body>
  <h1>Careme Recipes</h1>
  <h2>Location: {{.Location.Name}} ({{.Location.Address}})</h2>
  <div>
  {{range .Recipes}}
    <section>
    <h3>{{.Title}}</h3>
    <p>{{ .Description }}</p>
    <ul>
      {{range  .Ingredients }}
      <li>{{.Name}} - {{.Quantity}} - {{.Price}}</li>
      {{end}}
    </ul>
    <ol>
      {{range  .Instructions }}
      <li>{{.}}</li>
      {{end}}
    </ol>
    <p>{{.Health}}</p>
    <p>{{.DrinkPairing}}</p>
    <form method="POST" action="/user/recipes" class="save-form">
      <input type="hidden" name="recipe" value="{{.Title}}">
      <input type="hidden" name="hash" value="{{.ComputeHash}}">
      <button type="submit" class="save-btn">Save Recipe</button>
    </form>
    </section>
    {{end}}
  </div>

  <form method="GET" style="margin:1rem 0;display:flex;gap:.5rem">
    <input type="hidden" name="location" value="{{.Location.ID}}">
    <input type="hidden" name="date" value="{{.Date}}">
    <input type="text" name="instructions" placeholder="Enter extra instructions" value="{{.Instructions}}">
    <button type="submit">Apply Instructions</button>
  </form>

  <div>
    <button class="share-btn" onclick="shareRecipe()">Share Recipe</button>
    <span class="share-feedback" id="shareFeedback">Link copied!</span>
  </div>

  <script>
    function shareRecipe() {
      const hash = "{{.Hash}}";
      const shareUrl = window.location.origin + "/recipes?h=" + encodeURIComponent(hash);

      navigator.clipboard.writeText(shareUrl).then(function() {
        const feedback = document.getElementById('shareFeedback');
        feedback.style.display = 'inline';
        setTimeout(function() {
          feedback.style.display = 'none';
        }, 2000);
      }).catch(function(err) {
        alert('Failed to copy link: ' + err);
      });
    }
  </script>

  <footer>Generated by Careme.</footer>
</body>
</html>